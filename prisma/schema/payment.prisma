enum SubscriptionStatus {
  ACTIVE
  CANCELED
  PAID
  PENDING_PAYMENT
  ENDED
  PAST_DUE
}

model Subscription {
  id String @id @default(uuid())

  externalId String @unique // ID da assinatura na Stripe (sub_...)
  customerId String // ID do cliente na Stripe (cus_...)
  status     String // active, past_due, canceled

  currentPeriodStart DateTime
  currentPeriodEnd   DateTime

  tenantId String // Removido @unique para permitir hist√≥rico (1:N)
  tenant   Tenant @relation(fields: [tenantId], references: [id])

  planId String
  plan   Plan   @relation(fields: [planId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  Invoice   Invoice[]

  @@map("subscriptions")
}

model Invoice {
  id         String  @id @default(uuid())
  externalId String  @unique // O ID "inv_..." da Pagar.me
  amount     Decimal @db.Decimal(10, 2)
  status     String // paid, pending, failed

  subscriptionId String
  subscription   Subscription @relation(fields: [subscriptionId], references: [id])

  createdAt DateTime @default(now())

  @@map("invoices")
}

// Adicione ao seu schema.prisma

model PaymentTerm {
  id          String  @id @default(uuid())
  tenantId    String
  name        String // Ex: "Entrada + 30/60", "3x Boleto"
  description String?
  type        String // 'PAYABLE', 'RECEIVABLE', 'BOTH'
  isActive    Boolean @default(true)

  isFlexible Boolean @default(false)

  // Armazena as regras como JSON stringfied
  // Ex: '[{"days": 0, "percent": 33.33}, {"days": 30, "percent": 33.33}, {"days": 60, "percent": 33.34}]'
  rules     String
  Tenant    Tenant   @relation(fields: [tenantId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  titles    FinancialTitle[]
  movements FinancialMovement[]
  orders    Order[]

  @@map("payment_terms")
}
